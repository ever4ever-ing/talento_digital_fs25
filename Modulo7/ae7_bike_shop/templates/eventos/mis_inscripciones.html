{% extends 'base/base.html' %}

{% block title %}Mis Inscripciones - BikeShop{% endblock %}

{% block extra_css %}
<style>
    .inscripcion-card {
        transition: transform 0.2s;
    }
    .inscripcion-card:hover {
        transform: translateY(-3px);
    }
    .estado-badge {
        font-size: 0.9em;
        padding: 5px 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">ğŸ“‹ Mis Inscripciones a Eventos</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}

    {% if inscripciones %}
        <div class="row">
            {% for inscripcion in inscripciones %}
            <div class="col-md-6 mb-4">
                <div class="card inscripcion-card h-100">
                    {% if inscripcion.evento.imagen %}
                        <img src="{{ inscripcion.evento.imagen.url }}" class="card-img-top" 
                             alt="{{ inscripcion.evento.nombre }}" style="height: 180px; object-fit: cover;">
                    {% else %}
                        <div style="height: 180px; background: linear-gradient(135deg, #00392d 0%, #006e8c 100%); 
                                    display: flex; align-items: center; justify-content: center;">
                            <span style="font-size: 3em;">ğŸš´</span>
                        </div>
                    {% endif %}
                    
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">{{ inscripcion.evento.nombre }}</h5>
                            {% if inscripcion.estado == 'confirmada' %}
                                <span class="badge bg-success estado-badge">âœ“ Confirmada</span>
                            {% elif inscripcion.estado == 'pendiente' %}
                                <span class="badge bg-warning estado-badge">â³ Pendiente</span>
                            {% elif inscripcion.estado == 'cancelada' %}
                                <span class="badge bg-secondary estado-badge">âœ— Cancelada</span>
                            {% elif inscripcion.estado == 'completada' %}
                                <span class="badge bg-info estado-badge">âœ“ Completada</span>
                            {% endif %}
                        </div>

                        <p class="card-text">
                            <small>
                                <strong>ğŸ“… Fecha del Evento:</strong><br>
                                {{ inscripcion.evento.fecha_hora|date:"l, d de F de Y" }}<br>
                                {{ inscripcion.evento.fecha_hora|date:"H:i" }} hrs<br><br>
                                
                                <strong>ğŸ“ Destino:</strong> {{ inscripcion.evento.destino }}<br>
                                <strong>ğŸš© Punto de Encuentro:</strong> {{ inscripcion.evento.punto_encuentro }}<br>
                                <strong>ğŸ‘¥ Personas:</strong> {{ inscripcion.num_personas }}<br>
                                <strong>ğŸ’° Total Pagado:</strong> ${{ inscripcion.total_pagado }}
                            </small>
                        </p>

                        {% if inscripcion.contacto_emergencia %}
                        <div class="alert alert-light mb-3" style="font-size: 0.85em;">
                            <strong>ğŸš¨ Emergencia:</strong><br>
                            {{ inscripcion.contacto_emergencia }} - {{ inscripcion.telefono_emergencia }}
                        </div>
                        {% endif %}

                        {% if inscripcion.observaciones %}
                        <div class="alert alert-info mb-3" style="font-size: 0.85em;">
                            <strong>ğŸ“ Observaciones:</strong><br>
                            {{ inscripcion.observaciones }}
                        </div>
                        {% endif %}

                        <small class="text-muted">
                            Inscrito el {{ inscripcion.fecha_inscripcion|date:"d/m/Y H:i" }}
                        </small>
                    </div>
                    
                    <div class="card-footer bg-white">
                        <div class="d-grid gap-2">
                            <a href="{% url 'detalle_evento' inscripcion.evento.id %}" 
                               class="btn btn-outline-primary btn-sm">
                                Ver Evento
                            </a>
                            
                            {% if inscripcion.estado == 'confirmada' and not inscripcion.evento.evento_pasado %}
                            <form method="post" action="{% url 'cancelar_inscripcion' inscripcion.id %}" 
                                  onsubmit="return confirm('Â¿EstÃ¡s seguro de cancelar esta inscripciÃ³n?');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                                    Cancelar InscripciÃ³n
                                </button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info text-center">
            <h4>ğŸ“… No tienes inscripciones</h4>
            <p>AÃºn no te has inscrito a ningÃºn evento.</p>
            <a href="{% url 'lista_eventos' %}" class="btn btn-primary mt-3">
                Ver Eventos Disponibles
            </a>
        </div>
    {% endif %}

    <div class="mt-4">
        <a href="{% url 'lista_eventos' %}" class="btn btn-outline-primary">
            â† Ver Todos los Eventos
        </a>
    </div>
</div>
{% endblock %}
